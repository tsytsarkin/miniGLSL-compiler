%{
/**********************************************************************
 *
 * **YOUR GROUP INFO SHOULD GO HERE**
 *
 *  Interface to the scanner module for CSC467 course project
 **********************************************************************/


#include "common.h"
#include "parser.tab.h"
#include "string.h"


#define YY_USER_INIT { yyin = inputFile; }
#define	yyinput      input
#define yTRACE(x)    { if (traceScanner) fprintf(traceFile, "TOKEN %3d : %s\n", x, yytext); }
#define yERROR(x)    { fprintf(errorFile, "\nLEXICAL ERROR, LINE %d: %s\n", yyline, x); errorOccurred = TRUE; yyterminate(); }

int CheckInt(void);
int yyline = 1;

%}
%option noyywrap

WS                      [ \t]
NEWLINE                 \n
DIGIT                   [0-9]

%%
{WS}                      { }

{NEWLINE}               { yyline++; }

"/*"                    {
                          int c1      = 0;
                          int c2      = yyinput();
                          int curline = yyline;
                          for(;;) {
                            if (c2 == EOF) {
                              fprintf(errorFile, "\nLEXICAL ERROR, LINE %d: Unmatched /*\n", curline);
                              errorOccurred = TRUE;
                              yyterminate();
                            }
                            if (c1 == '*' && c2 == '/')
                              break;
                            c1 = c2;
                            c2 = yyinput();
                            if (c1 == '\n' && c2 != EOF)
                              yyline++;
                          }
                        }

{DIGIT}+"."{DIGIT}*     {
                          float floatval = atof(yytext);
                          yylval.floatval = floatval;
                          yTRACE(TOK_FLOAT);
                        }

{DIGIT}+                {
                          int intval = atoi(yytext);
                          if (intval < 0) {
                            yERROR("Integer overflow");
                          }
                          yylval.intval = intval;
                          yTRACE(TOK_INTEGER);
                        }

.                       { yERROR("Unknown token"); }

%%
